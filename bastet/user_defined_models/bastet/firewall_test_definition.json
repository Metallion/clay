{
  "type_name": "FirewallTestDefinition",
  "resource_name": "firewall_test_definitions",
  "to_be_migrated": false,
  "is_controller_enabled": true,
  "is_design_access_disabled": true,
  "fields": [
    {
      "name": "Number",
      "tag": "json:\"number\" yaml:\"number\"",
      "type_name": "int"
    },
    {
      "name": "TestScenarioID",
      "tag": "json:\"test_scenario_id\" yaml:\"test_scenario_id\"",
      "type_name": "int"
    },
    {
      "name": "TestScenario",
      "tag": "json:\"test_scenario\" yaml:\"test_scenario\"",
      "type_name": "TestScenario"
    },
    {
      "name": "SourcePortIpv4AddressID",
      "tag": "json:\"source_port_ipv4_address_id\" yaml:\"source_port_ipv4_address_id\"",
      "type_name": "int"
    },
    {
      "name": "SourcePortIpv4Address",
      "tag": "json:\"source_port_ipv4_address\" yaml:\"source_port_ipv4_address\"",
      "type_name": "PortIpv4Address"
    },
    {
      "name": "DestinationPortIpv4AddressID",
      "tag": "json:\"destination_port_ipv4_address_id\" yaml:\"destination_port_ipv4_address_id\"",
      "type_name": "int"
    },
    {
      "name": "DestinationPortIpv4Address",
      "tag": "json:\"destination_port_ipv4_address\" yaml:\"destination_port_ipv4_address\"",
      "type_name": "PortIpv4Address"
    },
    {
      "name": "TestStepID",
      "tag": "json:\"test_step_id\" yaml:\"test_step_id\"",
      "type_name": "int"
    },
    {
      "name": "TestStep",
      "tag": "json:\"test_step\" yaml:\"test_step\"",
      "type_name": "TestStep"
    },
    {
      "name": "Access",
      "tag": "json:\"access\" yaml:\"access\"",
      "type_name": "bool"
    }
  ],
  "sql_after_migration": [
    "drop view if exists firewall_test_definitions;",
    "create view if not exists firewall_test_definitions as",
    "  select source.test_step_number number,",
    "    source.test_scenario_id test_scenario_id,",
    "    source.value source_port_ipv4_address_id,",
    "    destination.value destination_port_ipv4_address_id,",
    "    test_steps.id test_step_id,",
    "    access.value access",
    "  from",
    "    (select * from test_scenario_parameters where name = 'source') source",
    "      inner join",
    "        (select * from test_scenario_parameters where name = 'destination') destination",
    "          on source.test_step_number = destination.test_step_number",
    "      inner join",
    "        (select * from test_scenario_parameters where name = 'access') access",
    "          on source.test_step_number = access.test_step_number",
    "      inner join test_scenario_test_step_associations",
    "        on source.test_scenario_id = test_scenario_test_step_associations.test_scenario_id",
    "        and source.test_step_number = test_scenario_test_step_associations.number",
    "      inner join test_scenarios",
    "        on test_scenario_test_step_associations.test_scenario_id = test_scenarios.id",
    "        and test_scenarios.name = 'FirewallTestScenario'",
    "      inner join",
    "        (select * from test_steps) test_steps",
    "        on test_scenario_test_step_associations.test_step_id = test_steps.id",
    "  where source.test_step_number is not null;",
    "insert or ignore into test_scenarios(name) values('FirewallTestScenario');"
  ]
}
